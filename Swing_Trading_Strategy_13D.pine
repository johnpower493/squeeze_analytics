//@version=6
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 13-Day Swing Trading Strategy - Trend Pullback System
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Description: Daily timeframe swing trading strategy that trades pullbacks in 
// trending markets with strict risk management and time-based exits.
// Timeframe: Daily chart only
// Markets: Equities, Futures, Crypto (liquid markets)
// Holding Period: Up to 13 days
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

strategy(
    title="Swing Trading Strategy (13D Hold)", 
    shorttitle="STS-13D",
    overlay=true,
    default_qty_type=strategy.percent_of_equity,
    default_qty_value=100,
    initial_capital=100000,
    currency=currency.USD,
    commission_type=strategy.commission.percent,
    commission_value=0.1,
    slippage=2,
    calc_on_every_tick=false,
    calc_on_order_fills=false,
    process_orders_on_close=true,
    max_bars_back=500
)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USER INPUTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// === EMA Settings ===
grpEMA = "EMA Settings"
emaFastLength = input.int(20, "Fast EMA Length", minval=5, maxval=50, group=grpEMA)
emaSlowLength = input.int(50, "Slow EMA Length", minval=20, maxval=200, group=grpEMA)

// === ATR Settings ===
grpATR = "ATR & Volatility"
atrLength = input.int(14, "ATR Length", minval=5, maxval=50, group=grpATR)
atrSmaLength = input.int(20, "ATR SMA Length (Volatility Filter)", minval=10, maxval=100, group=grpATR)
useVolFilter = input.bool(true, "Use Low Volatility Filter", group=grpATR, tooltip="Skip trades when ATR < ATR SMA")

// === Risk Management ===
grpRisk = "Risk Management"
riskPercent = input.float(1.0, "Risk Per Trade (%)", minval=0.1, maxval=10.0, step=0.1, group=grpRisk)
rMultipleTarget = input.float(2.0, "Take Profit (R-Multiple)", minval=1.0, maxval=10.0, step=0.5, group=grpRisk)
useTrailingStop = input.bool(true, "Use Trailing Stop After 1R", group=grpRisk)
trailingATRMult = input.float(2.0, "Trailing Stop ATR Multiplier", minval=0.5, maxval=5.0, step=0.5, group=grpRisk)

// === Time-Based Exit ===
grpTime = "Time-Based Exit"
exitBars = input.int(3, "Exit if < 0.5R after X bars", minval=1, maxval=10, group=grpTime)
minProgressR = input.float(0.5, "Minimum R Progress", minval=0.1, maxval=1.0, step=0.1, group=grpTime)

// === Trade Execution ===
grpExec = "Trade Execution"
slippageTicks = input.int(2, "Slippage (ticks)", minval=0, maxval=20, group=grpExec)
commissionPct = input.float(0.1, "Commission (%)", minval=0, maxval=1.0, step=0.01, group=grpExec)
tradeDirection = input.string("Both", "Trade Direction", options=["Long Only", "Short Only", "Both"], group=grpExec)

// === Visual Settings ===
grpVisual = "Visuals"
showEMAs = input.bool(true, "Show EMAs", group=grpVisual)
showRegime = input.bool(true, "Show Market Regime Label", group=grpVisual)
showEntryZone = input.bool(true, "Show Entry Zone", group=grpVisual)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// === EMAs ===
emaFast = ta.ema(close, emaFastLength)
emaSlow = ta.ema(close, emaSlowLength)

// Calculate EMA slope (difference over 5 bars)
emaSlowSlope = emaSlow - emaSlow[5]

// === ATR ===
atrValue = ta.atr(atrLength)
atrSMA = ta.sma(atrValue, atrSmaLength)

// Check if ATR is decreasing over last 3 bars (reduced volatility)
atrDecreasing = atrValue < atrValue[1] and atrValue[1] < atrValue[2]

// Volatility filter
lowVolatility = atrValue < atrSMA
volatilityOK = not useVolFilter or not lowVolatility

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKET REGIME DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Trending Up: 20 EMA > 50 EMA AND 50 EMA slope is positive
trendingUp = emaFast > emaSlow and emaSlowSlope > 0

// Trending Down: 20 EMA < 50 EMA AND 50 EMA slope is negative
trendingDown = emaFast < emaSlow and emaSlowSlope < 0

// Ranging: Neither trending up nor down
ranging = not trendingUp and not trendingDown

// Determine regime string for display
regimeString = trendingUp ? "ğŸ“ˆ TRENDING UP" : trendingDown ? "ğŸ“‰ TRENDING DOWN" : "â†” NO TRADE (RANGING)"
regimeColor = trendingUp ? color.green : trendingDown ? color.red : color.gray

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PULLBACK DETECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Price is in the zone between 20 EMA and 50 EMA
inPullbackZoneLong = close > emaSlow and close < emaFast and trendingUp
inPullbackZoneShort = close < emaSlow and close > emaFast and trendingDown

// Track if we've been in pullback zone (to identify when price enters zone)
var bool wasInPullbackZoneLong = false
var bool wasInPullbackZoneShort = false

// Detect entry into pullback zone
enteredPullbackZoneLong = inPullbackZoneLong and not wasInPullbackZoneLong
enteredPullbackZoneShort = inPullbackZoneShort and not wasInPullbackZoneShort

// Update tracking variables
wasInPullbackZoneLong := inPullbackZoneLong
wasInPullbackZoneShort := inPullbackZoneShort

// Find pullback low/high while in zone
var float pullbackLow = na
var float pullbackHigh = na

// Track pullback extremes while in zone
if inPullbackZoneLong
    pullbackLow := na(pullbackLow) ? low : math.min(pullbackLow, low)
else if not inPullbackZoneLong
    pullbackLow := na

if inPullbackZoneShort
    pullbackHigh := na(pullbackHigh) ? high : math.max(pullbackHigh, high)
else if not inPullbackZoneShort
    pullbackHigh := na

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENTRY CONDITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Long Entry Trigger: Bullish close above prior day's high
bullishBreakout = close > high[1] and close > open

// Short Entry Trigger: Bearish close below prior day's low
bearishBreakdown = close < low[1] and close < open

// Long Setup Complete
longSetup = (
    trendingUp and
    not na(pullbackLow) and
    atrDecreasing and
    bullishBreakout and
    volatilityOK and
    (tradeDirection == "Long Only" or tradeDirection == "Both")
)

// Short Setup Complete
shortSetup = (
    trendingDown and
    not na(pullbackHigh) and
    atrDecreasing and
    bearishBreakdown and
    volatilityOK and
    (tradeDirection == "Short Only" or tradeDirection == "Both")
)

// Only one position at a time
noPosition = strategy.position_size == 0
longEntry = longSetup and noPosition
shortEntry = shortSetup and noPosition

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POSITION SIZING & RISK CALCULATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Calculate position size based on risk
calcPositionSize(float entryPrice, float stopPrice, float riskPct) =>
    float accountRisk = strategy.equity * (riskPct / 100)
    float priceRisk = math.abs(entryPrice - stopPrice)
    float posSize = priceRisk > 0 ? accountRisk / priceRisk : 0
    posSize

// Store entry details
var float entryPrice = na
var float stopLoss = na
var float takeProfit = na
var int entryBar = na
var float riskAmount = na

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRADE EXECUTION - LONG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if longEntry
    // Entry at close
    entryPrice := close
    
    // Stop loss below pullback low
    stopLoss := pullbackLow
    
    // Calculate R (risk per share)
    riskAmount := entryPrice - stopLoss
    
    // Take profit at R-multiple
    takeProfit := entryPrice + (riskAmount * rMultipleTarget)
    
    // Record entry bar
    entryBar := bar_index
    
    // Calculate position size
    posSize = calcPositionSize(entryPrice, stopLoss, riskPercent)
    
    // Enter long position
    strategy.entry("Long", strategy.long, qty=posSize, comment="Long Entry")
    
    // Set stop loss and take profit
    strategy.exit("Long Exit", "Long", stop=stopLoss, limit=takeProfit, comment="SL/TP")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRADE EXECUTION - SHORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if shortEntry
    // Entry at close
    entryPrice := close
    
    // Stop loss above pullback high
    stopLoss := pullbackHigh
    
    // Calculate R (risk per share)
    riskAmount := stopLoss - entryPrice
    
    // Take profit at R-multiple
    takeProfit := entryPrice - (riskAmount * rMultipleTarget)
    
    // Record entry bar
    entryBar := bar_index
    
    // Calculate position size
    posSize = calcPositionSize(entryPrice, stopLoss, riskPercent)
    
    // Enter short position
    strategy.entry("Short", strategy.short, qty=posSize, comment="Short Entry")
    
    // Set stop loss and take profit
    strategy.exit("Short Exit", "Short", stop=stopLoss, limit=takeProfit, comment="SL/TP")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRAILING STOP (After 1R achieved)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool inPosition = strategy.position_size != 0
bool isLong = strategy.position_size > 0
bool isShort = strategy.position_size < 0

if inPosition and useTrailingStop and not na(entryPrice) and not na(riskAmount)
    // Calculate current R achieved
    if isLong
        currentProfit = close - entryPrice
        rAchieved = currentProfit / riskAmount
        
        // If we've achieved 1R, activate trailing stop
        if rAchieved >= 1.0
            trailingStopPrice = close - (atrValue * trailingATRMult)
            
            // Update stop if trailing stop is better than current stop
            if trailingStopPrice > stopLoss
                stopLoss := trailingStopPrice
                strategy.exit("Long Exit", "Long", stop=stopLoss, limit=takeProfit, comment="Trailing SL")
    
    if isShort
        currentProfit = entryPrice - close
        rAchieved = currentProfit / riskAmount
        
        // If we've achieved 1R, activate trailing stop
        if rAchieved >= 1.0
            trailingStopPrice = close + (atrValue * trailingATRMult)
            
            // Update stop if trailing stop is better than current stop
            if trailingStopPrice < stopLoss
                stopLoss := trailingStopPrice
                strategy.exit("Short Exit", "Short", stop=stopLoss, limit=takeProfit, comment="Trailing SL")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TIME-BASED EXIT (If < 0.5R after 3 bars)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if inPosition and not na(entryBar) and not na(entryPrice) and not na(riskAmount)
    barsInTrade = bar_index - entryBar
    
    // Check if we've been in trade for specified bars
    if barsInTrade >= exitBars
        if isLong
            currentProfit = close - entryPrice
            rAchieved = currentProfit / riskAmount
            
            // Exit if haven't achieved minimum R progress
            if rAchieved < minProgressR
                strategy.close("Long", comment="Time Exit (<0.5R)")
                entryPrice := na
                stopLoss := na
                takeProfit := na
                entryBar := na
        
        if isShort
            currentProfit = entryPrice - close
            rAchieved = currentProfit / riskAmount
            
            // Exit if haven't achieved minimum R progress
            if rAchieved < minProgressR
                strategy.close("Short", comment="Time Exit (<0.5R)")
                entryPrice := na
                stopLoss := na
                takeProfit := na
                entryBar := na

// Reset tracking when position closes
if noPosition and not na(entryPrice)
    entryPrice := na
    stopLoss := na
    takeProfit := na
    entryBar := na
    riskAmount := na

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VISUALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Plot EMAs
plot(showEMAs ? emaFast : na, "20 EMA", color=color.new(color.blue, 0), linewidth=2)
plot(showEMAs ? emaSlow : na, "50 EMA", color=color.new(color.orange, 0), linewidth=2)

// Highlight entry zone (between EMAs)
emaTop = math.max(emaFast, emaSlow)
emaBottom = math.min(emaFast, emaSlow)
zoneColor = trendingUp ? color.new(color.green, 90) : trendingDown ? color.new(color.red, 90) : na
fill(plot(showEntryZone ? emaTop : na), plot(showEntryZone ? emaBottom : na), color=zoneColor, title="Entry Zone")

// Plot stop loss and take profit levels for active position
plot(inPosition and not na(stopLoss) ? stopLoss : na, "Stop Loss", color=color.new(color.red, 0), style=plot.style_linebr, linewidth=2)
plot(inPosition and not na(takeProfit) ? takeProfit : na, "Take Profit", color=color.new(color.green, 0), style=plot.style_linebr, linewidth=2)

// Entry markers
plotshape(longEntry, "Long Entry", shape.triangleup, location.belowbar, color=color.new(color.green, 0), size=size.normal)
plotshape(shortEntry, "Short Entry", shape.triangledown, location.abovebar, color=color.new(color.red, 0), size=size.normal)

// Show pullback lows/highs
plotchar(not na(pullbackLow), "Pullback Low", "â—†", location.absolute, color=color.new(color.green, 30), size=size.tiny, offset=0)
plotchar(not na(pullbackHigh), "Pullback High", "â—†", location.absolute, color=color.new(color.red, 30), size=size.tiny, offset=0)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGIME & INFO TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table infoTable = table.new(position.top_right, 2, 10, bgcolor=color.new(color.black, 80), border_width=1)

if barstate.islast and showRegime
    // Header
    table.cell(infoTable, 0, 0, "Market Regime", text_color=color.white, text_size=size.normal)
    table.merge_cells(infoTable, 0, 0, 1, 0)
    
    // Regime status
    table.cell(infoTable, 0, 1, regimeString, text_color=regimeColor, text_size=size.normal)
    table.merge_cells(infoTable, 0, 1, 1, 1)
    
    // EMAs
    table.cell(infoTable, 0, 2, "20 EMA:", text_color=color.gray, text_size=size.small)
    table.cell(infoTable, 1, 2, str.tostring(emaFast, "#.##"), text_color=color.blue, text_size=size.small)
    
    table.cell(infoTable, 0, 3, "50 EMA:", text_color=color.gray, text_size=size.small)
    table.cell(infoTable, 1, 3, str.tostring(emaSlow, "#.##"), text_color=color.orange, text_size=size.small)
    
    // ATR
    table.cell(infoTable, 0, 4, "ATR:", text_color=color.gray, text_size=size.small)
    table.cell(infoTable, 1, 4, str.tostring(atrValue, "#.##"), text_color=color.white, text_size=size.small)
    
    table.cell(infoTable, 0, 5, "ATR Trend:", text_color=color.gray, text_size=size.small)
    atrTrendText = atrDecreasing ? "Decreasing âœ“" : "Not Decreasing"
    atrTrendColor = atrDecreasing ? color.green : color.red
    table.cell(infoTable, 1, 5, atrTrendText, text_color=atrTrendColor, text_size=size.small)
    
    // Volatility filter
    table.cell(infoTable, 0, 6, "Volatility:", text_color=color.gray, text_size=size.small)
    volText = lowVolatility ? "Low âš " : "Normal âœ“"
    volColor = lowVolatility ? color.orange : color.green
    table.cell(infoTable, 1, 6, volText, text_color=volColor, text_size=size.small)
    
    // Position info
    table.cell(infoTable, 0, 7, "Position:", text_color=color.gray, text_size=size.small)
    posText = noPosition ? "None" : isLong ? "LONG" : "SHORT"
    posColor = noPosition ? color.gray : isLong ? color.green : color.red
    table.cell(infoTable, 1, 7, posText, text_color=posColor, text_size=size.small)
    
    // R achieved
    if inPosition and not na(entryPrice) and not na(riskAmount)
        table.cell(infoTable, 0, 8, "R Achieved:", text_color=color.gray, text_size=size.small)
        currentProfit = isLong ? close - entryPrice : entryPrice - close
        rAchieved = currentProfit / riskAmount
        rColor = rAchieved >= 1.0 ? color.green : rAchieved >= 0 ? color.yellow : color.red
        table.cell(infoTable, 1, 8, str.tostring(rAchieved, "#.##") + "R", text_color=rColor, text_size=size.small)
        
        // Bars in trade
        barsInTrade = bar_index - entryBar
        table.cell(infoTable, 0, 9, "Bars in Trade:", text_color=color.gray, text_size=size.small)
        table.cell(infoTable, 1, 9, str.tostring(barsInTrade), text_color=color.white, text_size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(longEntry, title="Long Entry Signal", message="STS-13D: Long entry signal triggered")
alertcondition(shortEntry, title="Short Entry Signal", message="STS-13D: Short entry signal triggered")
alertcondition(trendingUp and trendingUp != trendingUp[1], title="Trending Up", message="STS-13D: Market regime changed to Trending Up")
alertcondition(trendingDown and trendingDown != trendingDown[1], title="Trending Down", message="STS-13D: Market regime changed to Trending Down")

